<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="/node_modules/js-cookie/src/js.cookie.js"></script>
    <title>accounts</title>
    <script>
      // перенаправляем юзера на authorized
      function RedirectAuthorized(username_id, user_avatar_id)
      {
        // берём имя и аватар из содержания блока
        var name = document.getElementById(username_id).innerHTML;
        var avatar = document.getElementById(user_avatar_id).src;
        console.log('SELECTED NAME: ' + name);
        console.log('SELECTED AVATAR: ' + avatar);
        // закидываем в куки, чтобы достать на authorized
        Cookies.set('selectedUserName', name, { path: '/', domain: 'zandau.kz', secure: true});
        Cookies.set('selectedUserAvatar', avatar, { path: '/', domain: 'zandau.kz', secure: true});
        // почистим старые куки - нам больше они не нужны
        for (let i = 0; i < 5; i++)                                                             // TODO: отсюда ещё нужно будет вытащить всю информацию про подписчиков и прочую хуйню
        {
          var name_key = 'userName' + i.toString();
          var avatar_key = 'userAvatar' + i.toString();
          Cookies.remove(name_key, { path: '/', domain: 'zandau.kz', secure: true});
          Cookies.remove(avatar_key, { path: '/', domain: 'zandau.kz', secure: true});
          console.log('COOKIES REMOVED: Информация об остальных аккаунтах стёрта.');
        }
        // перенаправляем пользователя на страницу authorized
        console.log('REDIRECT: Пользователь будет перенаправлен на authorized');
        window.location.href = 'authorized.html';
      }
    </script>
</head>
<body>
  <ul class="accounts">
    <!--Первый аккаунт-->
    <li>
      <h8 id="user_name_0" onclick="RedirectAuthorized('user_name_0', 'user_avatar_0')" style="display:none">
         аккаунт не найден
      </h8>
      <img id="user_avatar_0" src="img/avatar.png" alt="avatar_0" style="display:none">
    </li>
    <!--Второй аккаунт-->
    <li>
      <h8 id="user_name_1" onclick="RedirectAuthorized('user_name_1', 'user_avatar_1')" style="display:none">
        аккаунт не найден
      </h8>
      <img id="user_avatar_1" src="img/avatar.png" alt="avatar_1" style="display:none">
    </li>
    <!--Третий аккаунт-->
    <li>
      <h8 id="user_name_2" onclick="RedirectAuthorized('user_name_2', 'user_avatar_2')" style="display:none">
        аккаунт не найден
      </h8>
      <img id="user_avatar_2" src="img/avatar.png" alt="avatar_2" style="display:none">
    </li>
    <!--Четвёртый аккаунт-->
    <li>
      <h8 id="user_name_3" onclick="RedirectAuthorized('user_name_3', 'user_avatar_3')" style="display:none">
        аккаунт не найден
      </h8>
      <img id="user_avatar_3" src="img/avatar.png" alt="avatar_3" style="display:none">
    </li>
    <!--Пятый аккаунт-->
    <li>
      <h8 id="user_name_4" onclick="RedirectAuthorized('user_name_4', 'user_avatar_4')" style="display:none">
        аккаунт не найден
      </h8>
      <img id="user_avatar_4" src="img/avatar.png" alt="avatar_4" style="display:none">
    </li>
  </ul>
  <script>
    // даём юзеру выбрать аккаунт
    // достаём из куки имена и аватары пользователей
    console.log('COOKIE: Поиск имени пользователя');
    console.log('COOKIE: Поиск аватара пользователя');                                           // TODO: сначала надо скрыть все блоки с user_id, user_avatar
    // максимум может быть 5 аккаунтов по правилам FB/INSTA
    for (let i = 0; i < 5; i++)
    {
      // ключи, по которым будем вытягивать нужную куку с именем и авой
      var name_key = 'userName' + i.toString();
      var avatar_key = 'userAvatar' + i.toString();
      // сохраним полученные элементы
      var name = Cookies.get(name_key);
      var avatar = Cookies.get(avatar_key);
      // если они не пустые (мб там меньше 5 аккаунтов, тогда тут будет пусто)        // считаем, что у НОРМАЛЬНЫХ ЛЮДЕЙ ЕСТЬ ИМЯ И АВАТАРКА В БИЗНЕС-АККАУНТЕ
      if (name != 'undefined')
      {
        var name_id = "user_name_" + i.toString();
        console.log('NAME: ' + name);
        document.getElementById(name_id).style.display = 'list-item';
        document.getElementById(name_id).innerHTML = name;

        var avatar_id = "user_avatar_" + i.toString();
        console.log('AVATAR: ' + avatar);
        document.getElementById(avatar_id).style.display = 'list-item';
        document.getElementById(avatar_id).src = avatar;
      }
      else
      {
        break; //если получаем пустую куку, то дальше ничего уже нет
      }
    }
  </script>
</body>
</html>
